<div class="form-group"></div> <!-- spacer -->
<div class="form-group">
  <label for="queueManagerAddress" class="col-lg-2 control-label">Queue Manager Address</label>
  <div class="col-lg-7">
    <input type="text" name="queueManagerAddress" id="queueManagerAddress" class="form-control" readonly
           value="{{teststep.endpoint.otherProperties.host + ':' + teststep.endpoint.otherProperties.port + '/' +
             teststep.endpoint.otherProperties.queueManagerName}}">
  </div>
</div>
<div class="form-group">
  <label for="queueName" class="col-lg-2 control-label">Queue Name</label>
  <div class="col-lg-7">
    <input name="queueName" type="text" class="form-control" ng-change="autoSave(teststepForm.$valid)"
           ng-model="teststep.otherProperties.queueName" id="queueName" spellcheck="false">
  </div>
</div>
<div class="form-group">
  <label for="action" class="col-lg-2 control-label">Action</label>
  <div class="col-lg-2">
    <select name="action" id="action" class="form-control" ng-model="teststep.otherProperties.action"
            ng-change="actionChanged(teststepForm.$valid, '{{teststep.otherProperties.action}}')">
      <option value="Clear">Clear</option>
      <option value="CheckDepth">Check Depth</option>
      <option value="Dequeue">Dequeue</option>
      <option value="Enqueue">Enqueue</option>
    </select>
  </div>
  <div class="col-lg-1">
    <button type="button" class="btn btn-info" ng-click="doAction()"
            ng-disabled="!teststep.otherProperties.queueName || !teststep.otherProperties.action ||
              testrun.status === 'ongoing' ||
              (teststep.otherProperties.action === 'Enqueue' && !teststep.request)">Do</button>
  </div>
  <div class="col-lg-4">       <!-- Action run status message -->
    <h5 ng-if="teststep.otherProperties.action === 'Clear' && testrun.status === 'ongoing'">Clearing queue ...</h5>
    <h5 ng-if="teststep.otherProperties.action === 'Clear' && testrun.status === 'finished'">Queue cleared.</h5>
    <h5 ng-if="teststep.otherProperties.action === 'CheckDepth' && testrun.status === 'ongoing'">
      Checking queue depth ...</h5>
    <h5 ng-if="teststep.otherProperties.action === 'CheckDepth' && testrun.status === 'finished'">
      Queue depth is {{ testrun.response }}</h5>
    <h5 ng-if="teststep.otherProperties.action === 'Dequeue' && testrun.status === 'finished'">
      {{ testrun.response ? 'Message fetched.' : 'No more message available on the queue.' }}</h5>
    <h5 ng-if="teststep.otherProperties.action === 'Enqueue' && testrun.status === 'ongoing'">Sending message ...</h5>
    <h5 ng-if="teststep.otherProperties.action === 'Enqueue' && testrun.status === 'finished'">Message sent.</h5>
  </div>
</div>

<div ng-if="teststep.otherProperties.action === 'CheckDepth'">
  <div class="form-group">
    <label for="queueDepthAssertionValue" class="col-lg-2 control-label">Assertion</label>
    <div class="col-lg-2"><h5>Queue depth equals</h5></div>
    <div class="col-lg-5">
      <input name="queueDepthAssertionValue" id="queueDepthAssertionValue" type="number" class="form-control"
             ng-model="teststep.assertions[0].otherProperties.number" ng-change="autoSave(teststepForm.$valid)">
    </div>
  </div>
</div>

<div ng-if="teststep.otherProperties.action === 'Dequeue'">
  <div class="form-group">
    <label class="col-lg-2 control-label">Assertion</label>
    <div class="col-lg-2"><h5>XML Equal</h5></div>
  </div>
  <div class="form-group">
    <div class="col-lg-6">
      <textarea name="expectedXML" ng-model="teststep.assertions[0].otherProperties.expectedXML"
                ng-change="autoSave(teststepForm.$valid)" id="expectedXML" placeholder="Expected XML"
                class="form-control" rows="20" spellcheck="false"></textarea>
    </div>
    <div class="col-lg-6">
      <textarea name="actualXML" ng-model="testrun.response" id="actualXML"
                placeholder="{{ testrun.status === 'ongoing' ? '' : 'Actual XML' }}"
                class="form-control" rows="20" spellcheck="false"></textarea>
    </div>
  </div>
  <div class="form-group">
    <div class="col-lg-offset-1 col-lg-1">
      <button type="button" class="btn btn-info" ng-click="verifyXMLEqualAssertion()"
              ng-disabled="!teststep.assertions[0].otherProperties.expectedXML || !testrun.response">Verify</button>
    </div>
    <div class="col-lg-1">
      <h5 ng-if="assertionVerificationResult">
        {{ assertionVerificationResult.passed ? 'Passed' : 'Failed' }}</h5>
    </div>
    <div class="col-lg-8">
      <textarea name="verificationResult" ng-model="assertionVerificationResult.display"
                ng-class="{ 'text-red' : assertionVerificationResult.error }"
                id="verificationResult" class="form-control" rows="3" spellcheck="false" readonly></textarea>
    </div>
  </div>
</div>

<div ng-if="teststep.otherProperties.action === 'Enqueue'">
  <div class="form-group">
    <label for="enqueueMessageType" class="col-lg-2 control-label">Message Type</label>
    <div class="col-lg-7">
      <select name="enqueueMessageType" id="enqueueMessageType" class="form-control"
              ng-model="teststep.otherProperties.enqueueMessageType" ng-change="update(teststepForm.$valid)">
        <option value="Text">Text</option>
        <option value="Binary">Binary</option>
      </select>
    </div>
  </div>
  <div class="form-group" ng-if="teststep.otherProperties.enqueueMessageType === 'Text'">
    <div class="col-lg-9">
      <textarea name="enqueueTextMessage" id="enqueueTextMessage" ng-model="teststep.request"
                ng-change="autoSave(teststepForm.$valid)" class="form-control" rows="28" spellcheck="false"></textarea>
    </div>
  </div>
  <div class="form-group" ng-if="teststep.otherProperties.enqueueMessageType === 'Binary'">
    <div class="col-lg-9">
      <button type="file" ngf-select="uploadFile($file)" ngf-max-size="10MB">Select File</button>
    </div>
  </div>
</div>